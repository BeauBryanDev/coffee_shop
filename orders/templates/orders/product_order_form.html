{% extends 'base.html' %}

{% block title %}Add to Cart - Coffee Shop{% endblock %}

{% block content %}
<div class="fade-in max-w-3xl mx-auto bg-white p-8 rounded-3xl shadow-2xl">
    <h1 class="text-4xl font-bold text-gray-800 mb-8">Buy Product</h1>

    <!-- Display Messages -->
    {% if messages %}
    <div class="mb-6">
        {% for message in messages %}
        <div class="{% if message.tags == 'success' %}bg-green-100 border-l-4 border-green-500 text-green-700{% elif message.tags == 'error' %}bg-red-100 border-l-4 border-red-500 text-red-700{% else %}bg-blue-100 border-l-4 border-blue-500 text-blue-700{% endif %} p-4 rounded mb-2">
            <p class="font-semibold">{{ message }}</p>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <!-- Product Summary -->
    {% if product %}
    <div class="mb-8 bg-amber-50 rounded-2xl p-6 border-2 border-amber-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">Product Details</h2>
        <div class="space-y-3">
            <div class="flex justify-between">
                <span class="text-gray-600 font-semibold">Product:</span>
                <span class="text-gray-800 font-bold">{{ product.name }}</span>
            </div>
            <div class="flex justify-between">
                <span class="text-gray-600 font-semibold">Price:</span>
                <span class="text-amber-700 font-bold text-xl">${{ product.price }}</span>
            </div>
            <div class="flex justify-between">
                <span class="text-gray-600 font-semibold">Available Stock:</span>
                <span class="text-gray-800 font-bold">{{ product.stock }} units</span>
            </div>
            <div class="flex justify-between">
                <span class="text-gray-600 font-semibold">Category:</span>
                <span class="text-gray-800 font-bold">{{ product.category }}</span>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Order Form -->
    <form method="post" class="space-y-6">
        {% csrf_token %}

        {% if product %}
        <!-- Read-only Product Name Display -->
        <div class="mb-6">
            <label class="block text-gray-700 font-semibold mb-2">Selected Product</label>
            <div class="w-full px-4 py-3 bg-gray-100 border border-gray-300 rounded-lg text-gray-800 font-semibold">
                {{ product.name }}
            </div>
            <!-- Hidden field for form submission -->
            <input type="hidden" name="product_name" value="{{ product.id }}">
        </div>

        <!-- Read-only Price Per Item Display -->
        <div class="mb-6">
            <label class="block text-gray-700 font-semibold mb-2">Price Per Item</label>
            <div class="w-full px-4 py-3 bg-gray-100 border border-gray-300 rounded-lg text-amber-700 font-bold text-lg">
                ${{ product.price }}
            </div>
            <!-- Hidden field for form submission -->
            <input type="hidden" name="price_per_item" value="{{ product.price }}">
        </div>

        <!-- Editable Quantity Field -->
        <div class="mb-6">
            <label for="id_quantity" class="block text-gray-700 font-semibold mb-2">Quantity</label>
            <input type="number" name="quantity" id="id_quantity" min="1" max="{{ product.stock }}" value="1" required
                   class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-amber-700 transition duration-300 bg-white">
            {% if product_order_form.quantity.errors %}
                <p class="text-red-600 mt-2">{{ product_order_form.quantity.errors }}</p>
            {% endif %}
            <p class="text-gray-500 text-sm mt-1">Enter the quantity you want to order (Max: {{ product.stock }} available)</p>
        </div>
        
        {% else %}
        <!-- Fallback form if no product is pre-selected -->
        <div class="mb-6">
            <label for="id_product_name" class="block text-gray-700 font-semibold mb-2">Select Product</label>
            {{ product_order_form.product_name }}
            {% if product_order_form.product_name.errors %}
                <p class="text-red-600 mt-2">{{ product_order_form.product_name.errors }}</p>
            {% endif %}
        </div>
        
        <div class="mb-6">
            <label for="id_quantity" class="block text-gray-700 font-semibold mb-2">Quantity</label>
            {{ product_order_form.quantity }}
            {% if product_order_form.quantity.errors %}
                <p class="text-red-600 mt-2">{{ product_order_form.quantity.errors }}</p>
            {% endif %}
            <p class="text-gray-500 text-sm mt-1">Enter the quantity you want to order</p>
        </div>
        
        <div class="mb-6">
            <label for="id_price_per_item" class="block text-gray-700 font-semibold mb-2">Price Per Item</label>
            {{ product_order_form.price_per_item }}
            {% if product_order_form.price_per_item.errors %}
                <p class="text-red-600 mt-2">{{ product_order_form.price_per_item.errors }}</p>
            {% endif %}
        </div>
        {% endif %}
        
        <!-- Action Buttons -->
        <div class="flex gap-4 justify-end">
            <a href="{% url 'product_list' %}" class="bg-gray-400 hover:bg-gray-500 text-white py-3 px-8 rounded-lg font-semibold transition duration-300">
                Cancel
            </a>
            <button type="reset" class="bg-green-400 hover:bg-green-500 text-white py-3 px-8 rounded-lg font-semibold transition duration-300">
                Add to Favorites
            </button>
            <button type="submit" class="bg-orange-600 text-white py-3 px-8 rounded-lg font-semibold hover:from-amber-800 hover:to-orange-900 transform hover:scale-105 transition duration-300 shadow-lg border border-orange-900" >
                Buy Product
            </button>
        </div>
    </form>
</div>
{% endblock %}